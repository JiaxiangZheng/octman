---
layout: post
title: VIM高级技巧收集
categories:
- 编程与开发
tags:
- VIM
- 工具
---

## 文本编辑

## 基本命令

VIM中的删除命令`d`是一个使用频率非常高的命令，通常情况下其组合有`dw`、`de`、`dw`
等，但是如果我们处于一个单词的中间，但想要删除掉这个单词，通常情况下需要先移动到
单词开头然后再用`dw`删除。但是，**更简洁的方法是使用`daw`**，其意义为“删除一个
单词（delete a word）”。

与`v`相关的命令用于进入可视模式，其好处在于可以处理文本一部分的内容。但是，如果
在选中一部分区域后，我们需要向下增大其区域，但光标却在选中区域的上部，很多情况下
需要重新选择，这个时候其实可以使用`o`将光标移动到下部。使用`ctrl+v`的情况下，`o`
将把光标移动到对角端，这个时候可以使用`O`将光标进行水平方向的移动。

## 多文件操作

### 查找与替换

如果要匹配并替换多个文件中的内容时，有如下命令可以完成要求：（下面`|`用于连接不
同的命令）

1. 当所有要替换的文件都在缓冲区中的时候，可以使用`:bufdo %s/pattern/replace/ge | update`
   完成（可以使用`:ls`查看缓冲区中所有的文件）。
2. 对所有要替换的文件都在当前窗口中的时候，可以使用`:windo %s/pattern/replace/ge | wa`完
   成。
3. 对当前文件所在的文件夹内所有`*.cpp`和`*.h`的文件都要进行替换时，先使用`:arg *.cpp`
   加入所有`.cpp`文件到缓冲区，然后再`:argadd *.h`加入所有`.h`文件，使用
   `:argdo %s/pattern/replace/ge | update`达到替换的目的。

### 文件比较

在命令窗口中使用`vim -d file1 file2`可以比较两个文件，甚至我们可以在后面再加一个
文件名同时比较三个文件。比较结果将以高亮的形式展现出来。

另一种常见情况是已经将两个文件`vsplit`在屏幕中分成两列显示，需要直接比较这两个文
件的差异。这时可以使用`:diffthis`和`:diffsplit`，当然也可以使用`:windo diffthis`
，它表示比较窗口中打开的文件。

## 寄存器与缓冲区

### 寄存器

在使用VIM的过程中，经常需要将一个单词替换成另一个刚刚复制或剪切的单词，于是就使
用命令`diw`先将这个单词删掉，然后再使用`P`试图将复制或剪切的单词粘贴过来，结果发
现粘贴的居然是删掉的那个单词。在搞清楚这个问题之前，需要了解VIM的寄存器概念。

在电脑的系统中，我们复制或剪切了一段文字后，我们会发现这些文字是存放在了剪切板中
，供我们粘贴。在VIM中，这些内容不是放在剪切板，而是一个称为寄存器的东西里。与通
常使用的系统只有一个剪切板不同，VIM有多个寄存器，而且这些寄存器还可以命名（使用
`"{register}`，以双引号开头，表示这是寄存器），意味着我们可以随时地任意使用其中
一个。如果不使用名字，那么我们其实是在使用默认的一个称为未命名寄存器`""`。比如前
面这个问题，因为我们没有使用寄存器名称，因此当使用`diw` 后，元素实际上将之前未命
名寄存器的内容替换掉了，然后 `P`粘贴出来的就是这个最新的寄存器内容，也就是我们删
除的那个内容了。事实上，使用 `:reg`就可以查看当前系统的寄存器列表了，而
`:reg {register}`（即去掉`"`后的内容）则可以查看具体的寄存器内容了。（PS：我平时都是
使用visual mode先把要替换的内容选中，然后再按`P`进行粘贴。）

但是，带名称的寄存器事实上是不能任意使用的，因为有些寄存器是有特殊用途的，它主要
可以分为：[^1]

* 未命名寄存器`""`，用于缓存最后一次操作的内容
* 数字名寄存器`"{0-9}`，缓存最近操作内容，复制与删除是有区别的
    - `"0`称为复制（Yank）寄存器，因此如果像前面那个例子如果是复制而来的内容，我们在粘贴的时候可以使用`"0P`而无需多次键入带名称寄存器。
* 具名寄存器`"{a-z}`，可以自己指定使用
    - 如果是对应的大写字母，则在复制或剪切时不是覆盖，而是追加内容到对应的寄存器了
* 选择及拖拽寄存器：`"*`、`"+`和`"~`，存取GUI选择文本，可用于与外部应用交互，使用前提为系统剪切板可用
    - `"+`即系统剪切板对应的寄存器，可用于和系统剪切板进行交互
* 模式寄存器`"/`，缓存最近的搜索模式
* 行内删除寄存器`"-`，缓存行内删除内容
* 只读寄存器`":`、`".`、`"%`和`"#`，分别缓存最近命令、最近插入文本、当前文件名、当前交替文件名
* 表达式寄存器`"=`，只读，用于执行表达式命令
* 黑洞寄存器`"_`，不缓存操作内容（干净删除）

*依VIM的版本或所在系统，有些寄存器可能不可用，要特别注意！*

也许，你会注意到每次按`"{regester}P`这太麻烦了，那么，在输入模式下，按`Ctrl+R`
之后（注意不是在正常模式下输入，不然这就是撤销命令了），输入寄存器名称就可以了。
这种按键模式用起来更方便吧，毕竟每次都要输入一个双引号总会让人感觉怪怪的 ~~ :)

`Ctrl+R`组合命令的另一个好处在于，如果我们需要使用`/`命令搜索某段文字时（`*`只能
匹配某个单词），可以将该段文字保存在某个寄存器中，然后`/<C-R>{register}`就可以了
。 

总结一下，最简单的寄存器使用方式如下：

如果我们需要将当前行的内容复制到寄存器`a`，可以在正常模式下输入`"ayy`；而如果需
要将当前行内容追加到寄存器`a`，可以在正常模式下输入`"Ayy`；为了将这行内容粘贴到
文件的某个位置，可以使用`"ap`；为显示所有寄存器列表，使用`:reg`。

### 缓冲区列表

VIM可以同时加载多个文件到工作区（一般称为缓冲区，文件是在硬盘上的，但缓冲区是在
内存中，我们操作的实际上是缓冲区），因此很自然的一个需求就是如果我们需要同时对这
多个文件进行修改应该怎么办？

为了查看当前缓冲区中的文件列表，可以使用`:ls`命令，这与Unix中查看文件列表的命令
一致。当我们需要在多个文件中进行切换时，可以通过`:bn`或`:bp`来切换（意思是buffer
next和buffer previous），可以通过`:argadd filename`将文件加入到缓冲区，也可以通
过`:bd 1 2 3`删除某些缓冲区，其中的数字是`:ls`命令时看到的缓冲文件编号。

可以使用`:e!`强制重新加载文件，这通常用于外部已经更改文件的情况。

## VIM配置文件

VIM的设置可以通过修改vimrc文件与编写脚本文件来达到，下面主要是vimrc文件的设置相关问题。


* * *

**本文用于我平时积累的VIM技巧，内容将不定期更新**

--edit: 2014.9.12--



[^1]: http://www.yulefox.com/?p=1487


